package systems;
import components.Player;
import components.Velocity;
import components.Position;

import org.newdawn.slick.GameContainer;
import org.newdawn.slick.Input;

import util.Element;
import util.Spells;

import com.artemis.EntityProcessingSystem;
import com.artemis.Entity;
import com.artemis.ComponentMapper;



public class InputSystem extends EntityProcessingSystem{ 	
	private ComponentMapper<Player> player;
	private ComponentMapper<Velocity> vel;
	private ComponentMapper<Position> pos;
	private GameContainer gc;
	private boolean lastQ, lastE, lastW, lastR;
	
	public InputSystem(GameContainer gc)
	{
		super(Player.class, Velocity.class, Position.class);
		this.gc = gc;
	}
	
	public void initialize()
	{
		player = new ComponentMapper<Player>(Player.class, world);
		vel = new ComponentMapper<Velocity>(Velocity.class, world);
		pos = new ComponentMapper<Position>(Position.class, world);
	}
	
	public void process(Entity e)
	{
		Input input = gc.getInput();
		vel.get(e).setMagnitude(0);
		if(input.isKeyDown(Input.KEY_DOWN))
		{
			vel.get(e).setMagnitude(0.5f);
			vel.get(e).setDirection((float)Math.PI/2);
			pos.get(e).setTheta(180);
			pos.get(e).makeMove();
		}
		
		 if(input.isKeyDown(Input.KEY_UP))
		{
			vel.get(e).setMagnitude(0.5f);
			vel.get(e).setDirection((float)-Math.PI/2);
			pos.get(e).setTheta(0);
			pos.get(e).makeMove();
		}
		
		if(input.isKeyDown(Input.KEY_LEFT))
		{
			vel.get(e).setMagnitude(0.5f);
			vel.get(e).setDirection((float)Math.PI);
			pos.get(e).setTheta(-90);
			pos.get(e).makeMove();
		}
		
		if(input.isKeyDown(Input.KEY_RIGHT))
		{
			vel.get(e).setMagnitude(0.5f);
			vel.get(e).setDirection(0);
			pos.get(e).setTheta(90);
			pos.get(e).makeMove();
		}
		
		if(input.isKeyDown(Input.KEY_Q) && !lastQ)
		{
			player.get(e).pushElement(Element.FIRE);
		}
		
		if(input.isKeyDown(Input.KEY_W) && !lastW)
		{
			player.get(e).pushElement(Element.LIGHTNING);
		}
		
		if(input.isKeyDown(Input.KEY_E) && !lastE)
		{
			player.get(e).pushElement(Element.WATER);
		}
		
		if(input.isKeyDown(Input.KEY_R) && !lastR)
		{
			Element e1 = player.get(e).getElement(0);
			Element e2 = player.get(e).getElement(1);
			Element e3 = player.get(e).getElement(2);
			
			if(e1 == Element.WATER && e2 == Element.WATER)
			{
				switch(e3)
				{
				case LIGHTNING:
					player.get(e).pushSpell(Spells.WWL);break;
				case FIRE:
					player.get(e).pushSpell(Spells.WWF);break;
				case WATER:
					player.get(e).pushSpell(Spells.WWW);break;
				}
				
			}
			
			if(e1 == Element.LIGHTNING && e2 == Element.LIGHTNING)
			{
				switch(e3)
				{
				case LIGHTNING:
					player.get(e).pushSpell(Spells.LLL);break;
				case FIRE:
					player.get(e).pushSpell(Spells.LLF);break;
				case WATER:
					player.get(e).pushSpell(Spells.LLW);break;
				}
			}
			
			if(e1 == Element.FIRE && e2 == Element.FIRE)
			{
				switch(e3)
				{
				case LIGHTNING:
					player.get(e).pushSpell(Spells.FFL);break;
				case FIRE:
					player.get(e).pushSpell(Spells.FFF);break;
				case WATER:
					player.get(e).pushSpell(Spells.FFW);break;
				}
			}
			if(e1 == Element.FIRE && e2 == Element.WATER && e3 == Element.LIGHTNING)
			{
				player.get(e).pushSpell(Spells.FWL);
			}
		}
		
		
		
		lastQ = input.isKeyDown(Input.KEY_Q);
		lastW = input.isKeyDown(Input.KEY_W);
		lastE = input.isKeyDown(Input.KEY_E);
		lastR = input.isKeyDown(Input.KEY_R);
	}
}
